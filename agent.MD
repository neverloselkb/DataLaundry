# 에이전트 지침

> 이 파일은 CLAUDE.md, AGENTS.md, GEMINI.md에 모두 포함되어 있어 모든 AI 환경에서 동일한 지침이 로드됩니다.
그리고, 모든 아티팩트(*.md)와 설명은 항상 한국어로 작성하고 한국어로 답변하세요.

이 시스템은 신뢰성을 극대화하기 위해 각 기능을 분리한 3계층 아키텍처를 기반으로 합니다. LLM(로컬 로직 관리)은 확률적이지만, 대부분의 비즈니스 로직은 결정론적이며 일관성이 요구됩니다. 이 시스템은 이러한 불일치를 해결합니다.

## 3계층 아키텍처

**1계층: 지시문 (수행할 작업)**
- 기본적으로 Markdown으로 작성된 표준 운영 절차(SOP)이며, `directives/` 폴더에 있습니다.
- 목표, 입력, 사용할 도구/스크립트, 출력 및 예외 상황을 정의합니다.
- 중간 관리자에게 제공하는 것과 같은 자연어 지침입니다.

**2계층: 오케스트레이션 (의사 결정)**
- 바로 이 부분이 에이전트의 역할입니다. 지능형 라우팅을 담당합니다.

- 지시문을 읽고, 실행 도구를 올바른 순서로 호출하고, 오류를 처리하고, 설명을 요청하고, 학습한 내용을 바탕으로 지시문을 업데이트합니다.
- 의도와 실행을 연결하는 역할을 합니다. 예를 들어, 웹사이트 스크래핑을 직접 시도하는 대신 `directives/scrape_website.md`를 읽고 입력/출력을 정의한 다음 `execution/scrape_single_site.ts`를 실행합니다.

**3단계: 실행 (실제 작업 수행)**
- `execution/`에 있는 결정론적 스크립트
- 환경 변수, API 토큰 등은 `.env`에 저장
- API 호출, 데이터 처리, 파일 작업, 데이터베이스 상호 작용 처리
- 안정적이고, 테스트 가능하며, 빠릅니다. 수동 작업 대신 스크립트를 사용합니다. 주석이 잘 달려 있습니다.

**이 방식이 효과적인 이유:** 모든 작업을 직접 수행하면 오류가 누적됩니다. 단계별 정확도가 90%라고 해도 5단계 전체 성공률은 59%에 불과합니다. 해결책은 복잡한 작업을 결정론적 코드로 옮기는 것입니다. 이렇게 하면 의사 결정에만 집중할 수 있습니다.

## 운영 원칙

**1. 먼저 도구를 확인하세요**
스크립트를 작성하기 전에 지시 사항에 따라 `execution/`을 확인하세요. 스크립트가 없는 경우에만 새 스크립트를 생성하세요.

**2. 문제가 발생하면 자체적으로 수정하세요**
- 오류 메시지와 스택 트레이스를 읽으세요.
- 스크립트를 수정하고 다시 테스트하세요(유료 토큰/크레딧 등을 사용하는 경우는 제외 - 이 경우 사용자에게 먼저 확인하세요).
- 학습한 내용(API 제한, 타이밍, 예외 상황)을 반영하여 지시 사항을 업데이트하세요.
- 예: API 사용량 제한에 걸린 경우 → API를 확인하고 → 문제를 해결할 수 있는 배치 엔드포인트를 찾고 → 스크립트를 수정하고 → 테스트하고 → 지시 사항을 업데이트합니다.

**3. 학습하면서 지시 사항을 업데이트하세요**
지시 사항은 살아있는 문서입니다. API 제약 조건, 더 나은 접근 방식, 일반적인 오류 또는 타이밍 예상 등을 발견하면 지시 사항을 업데이트하세요. 하지만 명시적으로 요청받지 않는 한, 지시 사항을 생성하거나 덮어쓰지 마세요. 지시문은 명령어 세트이며, 보존하고 시간이 지남에 따라 개선해야 합니다(즉흥적으로 사용하고 버리는 것이 아닙니다).

## 자체 개선 루프

오류는 학습 기회입니다. 문제가 발생하면 다음 단계를 따르세요.
1. 수정
2. 도구 업데이트
3. 도구 테스트 및 정상 작동 확인
4. 새로운 흐름을 포함하도록 지시문 업데이트
5. 시스템이 더욱 강력해짐

## 파일 구성

**최종 결과물 vs. 중간 결과물:**
- **최종 결과물**: 사용자가 접근할 수 있는 Google Sheets, Google Slides 또는 기타 클라우드 기반 결과물
- **중간 결과물**: 처리 중에 필요한 임시 파일

**디렉토리 구조:**
- `.tmp/` - 모든 중간 파일(도시에, 스크랩된 데이터, 임시 내보내기). 절대 커밋하지 말고 항상 다시 생성해야 합니다.

- `execution/` - 스크립트(결정론적 도구)
- `directives/` - Markdown 형식의 표준 운영 절차(지시문)
- `.env` - 환경 변수 및 API 키
- `credentials.json`, `token.json` - Google OAuth 자격 증명(필수 파일, `.gitignore`에 포함)

**핵심 원칙:** 로컬 파일은 처리 용도로만 사용합니다. 최종 결과물은 사용자가 접근할 수 있는 클라우드 서비스(Google Sheets, Slides 등)에 저장됩니다. `.tmp/` 폴더의 모든 파일은 삭제 후 다시 생성할 수 있습니다.

## 요약

사용자의 의도(지시문)와 결정론적 실행(스크립트) 사이에서 역할을 수행합니다. 지시문을 읽고, 결정을 내리고, 도구를 호출하고, 오류를 처리하고, 시스템을 지속적으로 개선합니다.

실용적이고 신뢰할 수 있어야 하며, 자체적으로 개선해야 합니다.