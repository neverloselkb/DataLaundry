# 데이터 정제 전체 플로우 가이드

이 문서는 `data-clean-ai` 시스템의 데이터 분석 및 정제 로직이 작동하는 전체적인 흐름과 단계별 우선순위를 설명합니다.

---

## 1. 사전 분석 단계 (Analysis Phase)
데이터를 정제하기 전, 시스템은 데이터의 상태를 진단하고 최적의 정제 방법을 제안합니다.

### 1.1 데이터 이슈 감지 (`detectDataIssues`)
- **목적**: 데이터 품질 문제를 자동으로 식별합니다.
- **주요 검사 항목**:
    - **공백**: 문자열 앞뒤/중간의 불필요한 공백.
    - **전화번호**: 형식 불일치, 국가번호(82) 포함, 텍스트 혼입.
    - **날짜/일시**: 다양한 표기 방식(./-/년월일), 상대 날짜(어제, 오늘).
    - **이메일**: 유효하지 않은 이메일 형식.
    - **우편번호**: 5자리 미만 또는 텍스트 혼입.
    - **개인정보**: 마스킹되지 않은 주민등록번호(RRN), 계좌번호, 카드번호.
    - **가비지**: 깨진 문자열이나 의미 없는 데이터.
    - **금액**: 텍스트(원, ,)가 섞인 숫자 데이터.
    - **주소**: 너무 짧거나 불완전한 도로명 주소.

### 1.2 정제 포맷 추천 (`recommendColumnFormat`)
- **목적**: 컬럼의 데이터 패턴을 분석하여 가장 적합한 정제 옵션을 사용자에게 추천합니다.
- **작동 방식**: 상위 50개 행을 샘플링하여 정규식 패턴 매칭을 통해 `mobile`, `date`, `email`, `amount`, `rrn` 등의 타입을 결정합니다.

---

## 2. 데이터 정제 단계 (Processing Phase)
사용자의 요청에 따라 실제 데이터를 변환하는 핵심 단계입니다. `processDataLocal` 함수가 이 역할을 수행하며, 다음의 **4대 우선순위 원칙**을 준수합니다.

### 2.1 정제 우선순위 원칙
1.  **잠금 컬럼 보호**: 사용자가 잠금(Locked)으로 설정한 컬럼은 절대 수정하지 않습니다.
2.  **전역 옵션 우선**: 체크박스로 선택한 전역 옵션이 먼저 적용됩니다.
3.  **자연어 최종 적용**: 체크박스 수행 후, 사용자가 입력한 자연어(NLP) 요청을 최종 적용합니다.
4.  **자연어 포맷 존중**: 자연어로 특정 포맷(예: 날짜 구분자)을 지정하면 기본 포맷을 무시하고 해당 요청을 따릅니다.

### 2.2 상세 처리 단계 (Step-by-Step)

#### [Step 0] 컬럼 기반 일괄 치환
- 컬럼명 자체를 키워드로 사용하여 특정 데이터로 일괄 변경하는 단계입니다.

#### [Step 1] 전역 체크박스 옵션 (Checkbox Options)
- 사용자가 UI에서 체크한 일반적인 정제 규칙을 적용합니다.
- `공백 제거`, `연락처 표준화`, `날짜/일시 표준화`, `금액 콤마`, `이메일 검증`, `우편번호/사업자번호 포맷팅`, `개인정보 마스킹`, `가비지 제거` 등.

#### [Step 2] 자연어 스마트 처리 (NLP Smart)
- 사용자의 프롬프트를 분석하여 동적인 변환을 수행합니다.
- **추출/분리**: 주소에서 시/도 추출, 이메일에서 도메인 추출 등.
- **추가/제거**: 접두사(Prefix)/접미사(Suffix) 추가, 특수문자/괄호 제거.
- **대/소문자**: 특정 컬럼 또는 전체 데이터를 대문자/소문자로 변경.
- **패딩(Padding)**: 숫자를 특정 자릿수만큼 0으로 채움.
- **패턴 치환**: "A를 B로 바꿔줘"와 같은 사용자 정의 매핑 적용.

#### [Step 3] 개별 컬럼 지정 옵션 (Column Specific)
- 특정 컬럼에 대해 명시적으로 지정한 정제 옵션을 적용합니다.
- 이 단계는 모든 전역/자연어 처리 결과물의 최종 형태를 확고히 하는 역할을 합니다.

---

## 3. 사후 검증 및 통계 단계 (Verification Phase)
정제가 완료된 후, 데이터의 품질 변화를 측정합니다.

- **변화량 측정**: 변경된 셀의 개수와 해결된 이슈 수를 계산합니다.
- **품질 점수 (`qualityScore`)**: 데이터의 완결성(Completeness)과 유효성(Validity)을 종합하여 점수화(0-100점)합니다.

---

> [!TIP]
> **유지보수 시 주의사항**: 새로운 정제 로직을 추가할 때는 `processors.ts`의 통합 루프 내에서 적절한 단계를 찾아 추가해야 하며, 기존 우선순위 원칙이 깨지지 않도록 주의해야 합니다.
